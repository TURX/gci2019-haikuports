From b87eff763e9742b63747ca29b2a8cc2a159f174f Mon Sep 17 00:00:00 2001
From: TURX <turx2003@gmail.com>
Date: Wed, 15 Jan 2020 14:57:17 +0800
Subject: [PATCH] fix haiku support

---
 CMakeLists.txt      | 2 +-
 cmake/version.cmake | 4 ++--
 src/app/main.cpp    | 7 +++++++
 3 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index aaf04cf..911d59f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -230,7 +230,7 @@ target_include_directories(${LIB_UTILITY_PROJECT_NAME} SYSTEM
 
 target_link_libraries(${LIB_UTILITY_PROJECT_NAME} ${Boost_LIBRARIES} Qt5::Widgets Qt5::Network)
 
-if (UNIX AND NOT APPLE)
+if (UNIX AND NOT APPLE AND NOT HAIKU)
 	find_package(Threads REQUIRED)
 	target_link_libraries(${LIB_UTILITY_PROJECT_NAME} ${CMAKE_DL_LIBS} rt ${CMAKE_THREAD_LIBS_INIT})
 endif()
diff --git a/cmake/version.cmake b/cmake/version.cmake
index 5e8cf0a..69e9e0b 100644
--- a/cmake/version.cmake
+++ b/cmake/version.cmake
@@ -42,10 +42,10 @@ else(EXISTS "${CMAKE_SOURCE_DIR}/.git")
     set(VERSION_COMMIT "0")
     set(BUILD_TYPE "")
 
-endif(EXISTS "${CMAKE_SOURCE_DIR}/.git")
-
 set(VERSION_STRING "${VERSION_YEAR}.${VERSION_MINOR}.${VERSION_COMMIT}")
 
+endif(EXISTS "${CMAKE_SOURCE_DIR}/.git")
+
 message(STATUS "Version: ${VERSION_STRING}")
 
 # message(STATUS "Git current branch: ${GIT_BRANCH}")
diff --git a/src/app/main.cpp b/src/app/main.cpp
index a6f9679..cac1088 100644
--- a/src/app/main.cpp
+++ b/src/app/main.cpp
@@ -109,12 +109,19 @@ int main(int argc, char *argv[])
 		QCoreApplication::setAttribute(Qt::AA_EnableHighDpiScaling, true);
 	}
 
+#ifndef HAIKU
 	Version version(
 		VERSION_YEAR,
 		VERSION_MINOR,
 		VERSION_COMMIT,
 		GIT_COMMIT_HASH
 	);
+#else
+	Version version(
+		VERSION_STRING,
+		GIT_COMMIT_HASH
+	);
+#endif
 	QApplication::setApplicationVersion(version.toDisplayString().c_str());
 
 	MessageStatus(
-- 
2.20.1


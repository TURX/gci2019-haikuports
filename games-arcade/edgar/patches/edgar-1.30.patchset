From ef2c5a5906dc7319e9e6aeccffa8ee98eec2457d Mon Sep 17 00:00:00 2001
From: TURX <turx2003@gmail.com>
Date: Tue, 21 Jan 2020 23:14:22 +0800
Subject: [PATCH] fix Haiku support

---
 src/system/load_save.c | 23 +++++++++++++++++++++++
 1 file changed, 23 insertions(+)

diff --git a/src/system/load_save.c b/src/system/load_save.c
index 2d55feba5..704637bfc 100644
--- a/src/system/load_save.c
+++ b/src/system/load_save.c
@@ -41,6 +41,11 @@ Foundation, 51 Franklin Street, Suite 500, Boston, MA 02110-1335, USA.
 #include "load_save.h"
 #include "resources.h"
 
+#ifdef __HAIKU__
+#include <FindDirectory.h>
+#include <PathFinder.h>
+#endif
+
 static char gameSavePath[MAX_PATH_LENGTH], tempFile[MAX_PATH_LENGTH], saveFileIndex[MAX_PATH_LENGTH], continueFile[MAX_PATH_LENGTH];
 static int temporaryDataExists;
 
@@ -73,8 +78,14 @@ extern Game game;
 		#if MACOS == 1
 		snprintf(dir, sizeof(dir), "%s/Library/Application Support", userHome);
 		#else
+		#ifdef __HAIKU__
+		BPath path;
+		find_directory(B_USER_SETTINGS_DIRECTORY, &path);
+		snprintf(dir, sizeof(dir), "%s/parallelrealities", path.Path());
+		#else
 		snprintf(dir, sizeof(dir), "%s/.parallelrealities", userHome);
 		#endif
+		#endif
 
 		if ((mkdir(dir, S_IRWXU|S_IRWXG|S_IROTH|S_IXOTH) != 0) && (errno != EEXIST))
 		{
@@ -86,8 +97,14 @@ extern Game game;
 		#if MACOS == 1
 		snprintf(dir, sizeof(dir), "%s/Library/Application Support/Edgar", userHome);
 		#else
+		#ifdef __HAIKU__
+		BPath path;
+		find_directory(B_USER_SETTINGS_DIRECTORY, &path);
+		snprintf(dir, sizeof(dir), "%s/parallelrealities/Edgar", path.Path());
+		#else
 		snprintf(dir, sizeof(dir), "%s/.parallelrealities/edgar", userHome);
 		#endif
+		#endif
 
 		if ((mkdir(dir, S_IRWXU|S_IRWXG|S_IROTH|S_IXOTH) != 0) && (errno != EEXIST))
 		{
@@ -99,8 +116,14 @@ extern Game game;
 		#if MACOS == 1
 		snprintf(gameSavePath, sizeof(gameSavePath), "%s/Library/Application Support/Edgar/", userHome);
 		#else
+		#ifdef __HAIKU__
+		BPath path;
+		find_directory(B_USER_SETTINGS_DIRECTORY, &path);
+		snprintf(gameSavePath, sizeof(gameSavePath), "%s/parallelrealities/Edgar", path.Path());
+		#else
 		snprintf(gameSavePath, sizeof(gameSavePath), "%s/.parallelrealities/edgar/", userHome);
 		#endif
+		#endif
 
 		snprintf(tempFile, sizeof(tempFile), "%stmpsave", gameSavePath);
 
-- 
2.20.1

